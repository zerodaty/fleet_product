<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- RECORD 1: Herencia para la vista KANBAN del vehículo -->
    <record id="fleet_vehicle_kanban_inherit_workshop" model="ir.ui.view">
        <field name="name">fleet.vehicle.kanban.inherit.workshop</field>
        <field name="model">fleet.vehicle</field>
        <field name="inherit_id" ref="fleet.fleet_vehicle_view_kanban"/>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <!-- 1. Aseguramos que los campos estén disponibles para ser usados -->
            <xpath expr="//kanban" position="inside">
                <field name="customer_id"/>
                <field name="operational_state_id"/>
                <field name="active_service_count"/>
                <field name="priority"/>
                <field name="maintenance_contract_id"/>
            </xpath>

            <!-- 2. Coloca el Cliente/Propietario DESPUÉS del Conductor -->
            <xpath expr="//field[@name='driver_id']" position="after">
                <div t-if="record.customer_id.raw_value" class="small pt-1 pb-1">
                    <i class="fa fa-briefcase me-1" title="Propietario"/>
                    <field name="customer_id" widget="many2one_avatar" options="{'display_avatar_name': True}"/>
                </div>
            </xpath>

            <!-- 3. Muestra SÓLO la insignia de estado arriba -->
            <xpath expr="//field[@name='tag_ids']" position="after">
                <div class="mt-1 d-flex">
                    <field name="operational_state_id" widget="badge"/>
                </div>
            </xpath>

            <!-- 4. Mueve el botón de Servicios y las estrellas de Prioridad al footer -->
            <xpath expr="//footer//div" position="inside">
                 <a t-if="record.active_service_count.raw_value > 0" class="ms-3" type="object" name="action_open_services" href="#">
                    <i class="fa fa-wrench me-1" title="Servicios activos"/>
                    <field name="active_service_count"/> Servicio(s)
                </a>
                <field name="priority" widget="priority" class="ms-auto"/>
            </xpath>

            <!-- 5. Oculta el widget de actividades -->
            <xpath expr="//field[@name='activity_ids']" position="replace"/>
        </field>
    </record>

    <!-- RECORD 2: Herencia para la vista de FORMULARIO del vehículo -->
    <record id="fleet_vehicle_view_form_inherit" model="ir.ui.view">
    <field name="name">fleet.vehicle.view.form.inherit</field>
    <field name="model">fleet.vehicle</field>
    <field name="inherit_id" ref="fleet.fleet_vehicle_view_form"/>
    <field name="arch" type="xml">
                <!-- CORRECCIÓN: Usamos 'driver_id' como ancla porque existe en la vista original.
                Luego colocamos NUESTROS dos nuevos campos (customer_id y maintenance_contract_id) después de él. -->
            <xpath expr="//field[@name='driver_id']" position="before">
                <field name="customer_id" widget="many2one_avatar"/>
                <field name="maintenance_contract_id" context="{'default_partner_id': customer_id}"/>
            </xpath>
        </field>
    </record>
</odoo>