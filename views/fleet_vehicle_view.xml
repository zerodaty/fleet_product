<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="fleet_vehicle_kanban_inherit_workshop" model="ir.ui.view">
        <field name="name">fleet.vehicle.kanban.inherit.workshop</field>
        <field name="model">fleet.vehicle</field>
        <field name="inherit_id" ref="fleet.fleet_vehicle_view_kanban"/>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            
            <xpath expr="//kanban" position="attributes">
                <attribute name="default_group_by">operational_state_id</attribute>
            </xpath>
            
            <xpath expr="//templates/t[@t-name='card']" position="replace">
                <t t-name="card">
                    <div class="d-flex flex-row p-2"> <div class="o_kanban_image me-2"> <field name="image_128" widget="image" options="{'img_class': 'o_image_128_contain'}"/>
                        </div>
                        <div class="oe_kanban_details flex-grow-1"> <strong class="o_kanban_record_title"><field name="name"/></strong>
                            <div class="text-muted"><field name="license_plate"/></div>
                            
                            <div class="mt-1">
                                <field name="priority" widget="priority"/>
                            </div>

                            <div t-if="record.driver_id.raw_value" class="text-muted mt-1">
                                <i class="fa fa-user me-1" title="Conductor"/>
                                <field name="driver_id" widget="many2one_avatar_user" options="{'display_avatar_name': True}"/> </div>
                            
                            <div t-if="record.next_delivery_date.raw_value" class="mt-2">
                                <t t-set="today_js" t-value="new Date()"/>
                                <t t-set="today_date" t-value="new Date(today_js.getFullYear(), today_js.getMonth(), today_js.getDate())"/>
                                <t t-set="delivery_date" t-value="new Date(record.next_delivery_date.raw_value)"/>
                                
                                <div t-attf-class="o_kanban_record_subtitle {{ delivery_date.getTime() &lt; today_date.getTime() ? 'text-danger fw-bold' : (delivery_date.getTime() === today_date.getTime() ? 'text-warning fw-bold' : 'text-muted') }}">
                                    <i class="fa fa-clock-o me-1" title="PrÃ³xima Entrega"/>
                                    <field name="next_delivery_date" widget="date"/>
                                </div>
                            </div>
                            
                            <div class="mt-2" t-if="record.service_count.raw_value > 0">
                                <a name="action_open_services" type="object">
                                    <field name="service_count"/> Servicio(s) Activo(s)
                                </a>
                            </div>
                        </div>
                    </div>
                </t>
            </xpath>

        </field>
    </record>

</odoo>